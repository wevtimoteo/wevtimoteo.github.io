
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <title>Configurando ruby correto dentro de plugins do vim - wevtimoteo</title>

    <link rel="shortcut icon" href="/assets/images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/assets/images/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/prism.css">

    <style>
      img {
        max-width: 800px;
      }
    </style>
  </head>
  <body>
    <div id="wrapper">
      <header id="top">
        <h1><a href="/">wevtimoteo</a></h1>
        <p>kairos _ sharing _ tech _ learning _ kaizen _ path</p>
      </header>

      <nav>
        
<ul>
  <li><a href="/posts">Posts</a></li>
  <li><a href="/about.html">About</a></li>
</ul>

      </nav>

      <hr />

      <main><h1 id="configurando-ruby-correto-dentro-de-plugins-do-vim">Configurando ruby correto dentro de plugins do vim</h1><p>Posted on Monday, 6 Oct 2014 by Weverton Timoteo</p><p>Tags:</p><ul><li><a href="/tags/ruby">ruby</a></li><li><a href="/tags/vim">vim</a></li><li><a href="/tags/vim plugins">vim plugins</a></li></ul><p>Primeiro post de 2015 e primeiro post na plataforma Pelican depois da migração do <a href="http://octopress.org/">Octopress</a> para o <a href="http://blog.getpelican.com/">Pelican</a>. Depois escrevo sobre como foi essa migração.</p><p>Já tinha lido muitos artigos a respeito de <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity">Cyclomatic Complexity</a>, mas nunca tentei colocar algum script para avaliar meu código.</p><p>Antes tarde que nunca, encontrei o plugin <a href="https://github.com/fousa/vim-flog">vim-flog</a> que é um fork do <a href="https://github.com/skammer/vim-ruby-complexity">vim-ruby-complexity</a>; que como o nome já diz, serve para avaliar a Complexidade Ciclomática dentro de scripts .rb.</p><p>Acontece que esse plugin executa código ruby dentro do arquivo <code class="inline">.vim</code> (caso queira saber mais: <a href="http://mattmargolis.net/scripting_vim_with_ruby.pdf">Scripting Vim with Ruby</a>).</p><p>Até então, isso não deveria ser um problema. Acontece que quando o script rodava:</p><pre><code class="ruby">ruby &lt;&lt; EOF

require &#39;rubygems&#39;
require &#39;flog&#39;

class Flog</code></pre><p>Ocorria um erro na linha <code class="inline">require &#39;flog&#39;</code> que não encontrava a <code class="inline">gem</code>, apesar de eu já ter instalado no meu <code class="inline">ruby</code> local usando <code class="inline">gem install flog</code>.</p><p>Tentei entender o problema olhando o <code class="inline">$GEM_PATH</code>, <code class="inline">$GEM_ROOT</code> e <code class="inline">$GEM_HOME</code> dentro do código do plugin, no entanto, ambos estavam vazios.</p><p>Parti para outro caminho e olhei o path do ruby executado adicionando:</p><pre><code class="ruby">puts $:

require &#39;rubygems&#39;
require &#39;flog&#39;</code></pre><p>O <code class="inline">$:</code> serve para imprimir o path de onde o <code class="inline">ruby</code> é procurado (tente rodar isso dentro do <code class="inline">irb</code>).</p><p>Nesse comando, percebi que o <code class="inline">ruby</code> que estava sendo executado era o que vem juntamente do OS X Yosemite (2.x) e não o meu <code class="inline">ruby</code> do <code class="inline">rbenv</code> (alternativa ao <code class="inline">rvm</code>).</p><p>Como eu sempre fiz upgrade nos releases do <code class="inline">OS X</code> e nunca um clean install.
Achei um report do bug no <a href="https://github.com/dotphiles/dotzsh#mac-os-x">path_helper</a>, para resolver isso, basta:</p><pre><code class="">sudo chmod ugo-x /usr/libexec/path_helper</code></pre><p>Segue trecho do link acima caso o link se torne obsoleto:</p><pre><code class="">path_helper is intended to make it easier for installers to add new paths to the environment without having to edit shell configuration files by adding a file with a path to the /etc/paths.d directory.

Unfortunately, path_helper always reads paths from /etc/paths set by Apple then paths from /etc/paths.d set by third party installers, and lastly paths from the PATH environment variable set by the parent process, which ultimately is set by the user with export PATH=... Thus, it reorders path priorities, and user /bin directories meant to override system /bin directories end up at the tail of the array.</code></pre></main>

      <hr />

      <footer>
        
<a href="https://dev.to/wevtimoteo" target="_blank" style="float: right">
  <img src="https://d2fltix0v2e0sb.cloudfront.net/dev-badge.svg" alt="Weverton Timoteo's DEV Profile" height="30" width="30">
</a>

<a href="https://github.com/wevtimoteo/wevtimoteo.github.io" target="_blank" style="float: right;margin-right: 10px">
  <?xml version="1.0" ?><!DOCTYPE svg  PUBLIC '-//W3C//DTD SVG 1.1//EN'  'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'><svg enable-background="new 0 0 30 30" height="30px" id="Layer_1" version="1.1" viewBox="0 0 512 512" width="30px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path clip-rule="evenodd" d="M296.133,354.174c49.885-5.891,102.942-24.029,102.942-110.192   c0-24.49-8.624-44.448-22.67-59.869c2.266-5.89,9.515-28.114-2.734-58.947c0,0-18.139-5.898-60.759,22.669   c-18.139-4.983-38.09-8.163-56.682-8.163c-19.053,0-39.011,3.18-56.697,8.163c-43.082-28.567-61.22-22.669-61.22-22.669   c-12.241,30.833-4.983,53.057-2.718,58.947c-14.061,15.42-22.677,35.379-22.677,59.869c0,86.163,53.057,104.301,102.942,110.192   c-6.344,5.452-12.241,15.873-14.507,30.387c-12.702,5.438-45.808,15.873-65.758-18.592c0,0-11.795-21.31-34.012-22.669   c0,0-22.224-0.453-1.813,13.592c0,0,14.96,6.812,24.943,32.653c0,0,13.6,43.089,76.179,29.48v38.543   c0,5.906-4.53,12.702-15.865,10.89C96.139,438.977,32.2,354.626,32.2,255.77c0-123.807,100.216-224.022,224.03-224.022   c123.347,0,224.023,100.216,223.57,224.022c0,98.856-63.946,182.754-152.828,212.688c-11.342,2.266-15.873-4.53-15.873-10.89   V395.45C311.1,374.577,304.288,360.985,296.133,354.174L296.133,354.174z M512,256.23C512,114.73,397.263,0,256.23,0   C114.73,0,0,114.73,0,256.23C0,397.263,114.73,512,256.23,512C397.263,512,512,397.263,512,256.23L512,256.23z" fill="#0D2636" fill-rule="evenodd"/></g></svg>
</a>

<p>
  Powered by <a href="https://github.com/Dalgona/Serum">Serum</a> v1.5.1,
  with <a href="https://github.com/Dalgona/serum-theme-essence">Essence</a> theme
</p>

      </footer>
    </div>

    <script src="/assets/js/prism.js"></script>
  </body>
</html>
<script>
const ws_url = "ws://" + location.host + "/serum_live_reloader";
var ws;

connect();

function connect() {
  ws = new WebSocket(ws_url);
  ws.onmessage = onMessage;
  ws.onclose = onClose;
}

function onMessage(e) {
  if (e.data === "reload") {
    location.reload();
  }
}

function onClose(e) {
  console.warn("WebSocket disconnected from server. Reconnecting in 10 seconds.");
  setTimeout(connect, 10000)
}
</script>
